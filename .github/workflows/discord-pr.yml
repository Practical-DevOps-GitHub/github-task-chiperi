name: Discord - PR notification

on:
  pull_request:
    types: [opened, reopened, ready_for_review]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send Discord message
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
          PR_TITLE: ${{ github.event.pull_request.title }}
          PR_URL: ${{ github.event.pull_request.html_url }}
          PR_AUTHOR: ${{ github.event.pull_request.user.login }}
          PR_BASE: ${{ github.event.pull_request.base.ref }}
          PR_HEAD: ${{ github.event.pull_request.head.ref }}
          REPO: ${{ github.repository }}
        run: |
          payload=$(cat <<EOF
          {
            "content": "**New Pull Request** in **$REPO**\n**$PR_TITLE**\nAuthor: **$PR_AUTHOR**\nBranch: **$PR_HEAD -> $PR_BASE**\n$PR_URL"
          }
          EOF
          )
          curl -H "Content-Type: application/json" -d "$payload" "$DISCORD_WEBHOOK_URL"
